% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/add_alma.R
\name{add_alma}
\alias{add_alma}
\title{Calculate and add Arnaud Legoux Moving Averages (ALMA) to stock data}
\usage{
add_alma(
  mktdata,
  periods = c(50, 200),
  offset = 0.85,
  sigma = 6,
  append = TRUE
)
}
\arguments{
\item{mktdata}{xts object containing OHLCV data downloaded via quantmod}

\item{periods}{numeric vector with 2-4 positive integers representing ALMA periods}

\item{offset}{numeric between 0 and 1 determining the position of the weight
distribution. Default is 0.85, which provides good balance between lag and noise.}

\item{sigma}{numeric specifying the width of the Gaussian filter. Default is 6.0.}

\item{append}{logical. If TRUE, add ALMA columns to mktdata; otherwise, return only ALMA columns. Default is TRUE.}
}
\value{
If \code{append} is \code{TRUE}, a tibble object with added ALMA columns.
If \code{FALSE}, a tibble object with only ALMA columns.
}
\description{
This function calculates ALMA, a highly efficient moving average
that uses a Gaussian distribution to weight data points, reducing lag and
providing excellent noise reduction.
}
\details{
ALMA is calculated using a Gaussian distribution to weight data points,
with the peak of the distribution determined by the offset parameter.
This allows the moving average to react quickly to price changes while
maintaining smoothness. The calculation steps are:

1. **Determine the peak position (m)**:
   \[
   m = \text{floor}(\text{offset} \cdot (n-1))
   \]
   where \code{n} is the period and \code{offset} controls the weight
   distribution center (0.85 by default, favoring recent prices).

2. **Compute Gaussian weights**:
   \[
   w_i = \exp\left(-\frac{(i - m)^2}{2\sigma^2}\right)
   \]
   for each data point \code{i} in the window, where \code{\sigma}
   (default 6.0) controls the width of the distribution.

3. **Normalize weights**:
   \[
   \text{Normalized } w_i = \frac{w_i}{\sum_{i=0}^{n-1} w_i}
   \]

4. **Calculate weighted average**:
   \[
   \text{ALMA}_t = \sum_{i=0}^{n-1} (\text{Normalized } w_i \cdot \text{Price}_{t-i})
   \]

Higher \code{offset} values prioritize recent prices, reducing lag but
increasing sensitivity to noise. Lower \code{sigma} values create a
tighter weight distribution, focusing on fewer data points.
}
\note{
Input data must contain closing prices (Close)
}
\examples{
library(quantmod)
library(tibble)
library(zoo)
library(dplyr)
# Load internal Tesla stock data
data(TSLA)
# Calculate and add ALMA columns to TSLA data with default parameters
tsla_with_alma <- add_alma(TSLA, periods = c(10, 20))
head(tsla_with_alma)
# Calculate ALMA with custom offset and sigma
tsla_alma_custom <- add_alma(TSLA, periods = 20, offset = 0.5, sigma = 4.0, append = FALSE)
head(tsla_alma_custom)
}
\keyword{ALMA,}
\keyword{Arnaud}
\keyword{Legoux,}
\keyword{analysis,}
\keyword{quantmod}
\keyword{technical}
